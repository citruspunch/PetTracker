import{w as N}from"./with-props-C_P4RWeF.js";import{a as l,w as P,o as e}from"./chunk-LSOULM7L-DOIZURii.js";import{u as v,N as L}from"./navbar-mFlRC7PZ.js";import{C as S,a as y,b as A,e as R,c as M}from"./card-Cx2DBwdG.js";import{A as T,M as _,u as q,s as B,a as z,c as D}from"./routes-CTRM3soR.js";import{L as V}from"./Loader-CXAdXc2l.js";import{B as U}from"./button-BwhTU3xm.js";import{z as m,u as G,s as H,F as O,a as d,b as u,c as p,d as x,e as j}from"./index-CMz1EfI-.js";import{I as f}from"./input-Cc9Stvst.js";import{t as C}from"./index-DlVqQRiW.js";import"./index-CGXivZb0.js";import"./index-BPjMvHEu.js";import"./createLucideIcon-BXJY-pLu.js";import"./loader-circle-4zLNCx83.js";import"./index-CpYXc7B6.js";const X=m.object({first_name:m.string({required_error:"El nombre es requerido"}).trim().nonempty("El nombre no puede estar vacío"),last_name:m.string().trim().optional(),image_url:m.instanceof(FileList).optional().refine(r=>{var s;return(r==null?void 0:r.length)===0||T.includes(((s=r==null?void 0:r.item(0))==null?void 0:s.type)??"")},"Solo archivos en formato .jpg, .jpeg, .png y .webp son aceptados.").refine(r=>{var s;return(r==null?void 0:r.length)===0||(((s=r==null?void 0:r.item(0))==null?void 0:s.size)??_+1)<=_},"El tamaño máximo permitido de la foto es 5MB.")}),Y=({userId:r,submitButtonText:s="Continuar"})=>{const[o,h]=l.useState(!1),b=P(),[g,F]=l.useState(void 0),t=G({resolver:H(X),defaultValues:{first_name:"",last_name:""}}),w=a=>{var n;const i=(n=a.target.files)==null?void 0:n[0];if(i){const c=new FileReader;c.onload=()=>{F(c.result)},c.readAsDataURL(i)}},E=async a=>{h(!0);const i=a.image_url?await q(a.image_url,"profiles-pictures"):null,n=await B.from("profiles").update({first_name:a.first_name,last_name:a.last_name,image_url:i}).eq("id",r);if(h(!1),n.error===null){C.success("Tu perfil ha sido actualizado"),b(`${z.dashboard}`);return}C.error("Ocurrió un error al editar la información de tu perfil. Inténtalo de nuevo."),console.error(n.error)},I=t.register("image_url");return e.jsx(O,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(E),className:"space-y-6",children:[e.jsx(d,{control:t.control,name:"first_name",render:({field:a})=>e.jsxs(u,{children:[e.jsx(p,{children:"Nombre"}),e.jsx(x,{children:e.jsx(f,{...a})}),e.jsx(j,{})]})}),e.jsx(d,{control:t.control,name:"last_name",render:({field:a})=>e.jsxs(u,{children:[e.jsx(p,{children:"Apellido"}),e.jsx(x,{children:e.jsx(f,{...a})}),e.jsx(j,{})]})}),e.jsx(d,{control:t.control,name:"image_url",render:()=>e.jsxs(u,{children:[e.jsx(p,{children:"Foto"}),e.jsx(x,{children:e.jsx("div",{className:"flex flex-col items-center space-y-4",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[g&&e.jsx("img",{src:g,alt:"Vista previa",className:"h-32 w-32 rounded-full object-cover"}),e.jsx(f,{type:"file",...I,onChange:a=>{w(a)}})]})})}),e.jsx(j,{})]})}),e.jsx(U,{type:"submit",className:"w-full",children:o?e.jsx(V,{}):e.jsx(e.Fragment,{children:s})})]})})},Z=({className:r,userId:s,...o})=>e.jsxs(S,{className:D("m-5",r),...o,children:[e.jsxs(y,{children:[e.jsx(A,{className:"text-3xl sm:text-4xl",children:"Completa tu perfil"}),e.jsx(R,{children:"Llena la siguiente información para que podamos brindarte una mejor experiencia."})]}),e.jsx(M,{className:"grid gap-4",children:e.jsx(Y,{userId:s,submitButtonText:"Listo"})})]}),$=()=>{const r=v(),[s,o]=l.useState(!0);return l.useEffect(()=>{r&&o(!1)},[r]),e.jsxs(e.Fragment,{children:[e.jsx(L,{}),!s&&e.jsx(Z,{userId:r.id})]})},k=()=>e.jsx($,{}),de=N(k);export{de as default};
